[{"filePath":"C:\\Users\\avi\\Desktop\\KARTIK\\Code\\Plotit-2.0\\server\\src\\entities\\map\\map.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":157,"column":15,"messageId":"anyAssignment","endLine":157,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .key on an `any` value.","line":157,"column":34,"messageId":"unsafeMemberExpression","endLine":157,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":158,"column":48,"messageId":"unsafeMemberExpression","endLine":158,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":160,"column":65,"messageId":"unsafeArgument","endLine":160,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":164,"column":13,"messageId":"anyAssignment","endLine":164,"endColumn":20}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Request, Response } from \"express\";\r\nimport { paramsSchema } from \"@/common/common.validation\";\r\nimport log from \"@/utils/logger\";\r\nimport type { MapService } from \"@/entities/map/map.service\";\r\nimport {\r\n    createMapSchema,\r\n    gridCellUpdateSchema,\r\n    gridSetupSchema,\r\n    mapQuerySchema,\r\n    svgMappingSchema,\r\n    updateMapSchema,\r\n} from \"@/entities/map/map.validation\";\r\nimport {\r\n    validateBody,\r\n    validateParams,\r\n    validateQuery,\r\n} from \"@/middleware/validation.middleware\";\r\n\r\nexport class MapController {\r\n    private mapService: MapService;\r\n\r\n    constructor(mapService: MapService) {\r\n        this.mapService = mapService;\r\n    }\r\n\r\n    async create(req: Request, res: Response): Promise<void> {\r\n        const data = validateBody(req.body, createMapSchema);\r\n        const file = req.file;\r\n\r\n        if (!file) {\r\n            res.status(400).json({ success: false, message: \"Image file is required\" });\r\n            return;\r\n        }\r\n\r\n        const map = await this.mapService.createMap(data, file);\r\n\r\n        log.info(\"Map created successfully\", {\r\n            mapId: map.id,\r\n            operation: \"create_map\"\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            data: map,\r\n            message: \"Map created successfully\"\r\n        });\r\n    }\r\n\r\n    async getAll(req: Request, res: Response): Promise<void> {\r\n        const queryParams = validateQuery(req.query, mapQuerySchema);\r\n\r\n        const result = await this.mapService.getMapsWithRelations(queryParams);\r\n\r\n        log.info(\"Maps retrieved successfully\", {\r\n            count: result.data.length,\r\n            totalItems: result.pagination.totalItems,\r\n            currentPage: result.pagination.currentPage,\r\n            operation: \"get_maps\",\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: result.data,\r\n            pagination: result.pagination,\r\n            message: \"Maps retrieved successfully\",\r\n        });\r\n    }\r\n\r\n    async getById(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n\r\n        const map = await this.mapService.getMapByIdWithRelations(mapId);\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: map,\r\n            message: \"Map retrieved successfully\"\r\n        });\r\n    }\r\n\r\n    async update(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n        const data = validateBody(req.body, updateMapSchema);\r\n        const file = req.file;\r\n\r\n        const map = await this.mapService.updateMap(mapId, data, file);\r\n\r\n        log.info(\"Map updated successfully\", {\r\n            mapId: map.id,\r\n            operation: \"update_map\"\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: map,\r\n            message: \"Map updated successfully\"\r\n        });\r\n    }\r\n\r\n    async delete(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n\r\n        const success = await this.mapService.deleteMap(mapId);\r\n\r\n        log.info(\"Map deleted successfully\", {\r\n            mapId,\r\n            operation: \"delete_map\"\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: success,\r\n            message: \"Map deleted successfully\"\r\n        });\r\n    }\r\n\r\n    // Grid operations\r\n\r\n    async initializeGrid(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n        const settings = validateBody(req.body, gridSetupSchema);\r\n\r\n        const map = await this.mapService.updateGridSettings(mapId, settings);\r\n\r\n        log.info(\"Grid settings initialized\", {\r\n            mapId,\r\n            operation: \"initialize_grid\"\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: map,\r\n            message: \"Grid settings initialized successfully\"\r\n        });\r\n    }\r\n\r\n    async updateGrid(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n        const settings = validateBody(req.body, gridSetupSchema);\r\n\r\n        const map = await this.mapService.updateGridSettings(mapId, settings);\r\n\r\n        log.info(\"Grid settings updated\", {\r\n            mapId,\r\n            operation: \"update_grid\"\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: map,\r\n            message: \"Grid settings updated successfully\"\r\n        });\r\n    }\r\n\r\n    async updateCell(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n        const cellKey = req.body.key;\r\n        const cellData = validateBody(req.body.data, gridCellUpdateSchema);\r\n\r\n        const map = await this.mapService.updateCellData(mapId, cellKey, cellData);\r\n\r\n        log.info(\"Grid cell updated\", {\r\n            mapId,\r\n            cellKey,\r\n            operation: \"update_cell\"\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: map,\r\n            message: \"Grid cell updated successfully\"\r\n        });\r\n    }\r\n\r\n    // SVG Mapping operations\r\n\r\n    async addSvgMapping(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n        const mappingData = validateBody({ ...req.body, mapId }, svgMappingSchema);\r\n\r\n        const mapping = await this.mapService.createSvgMapping(mappingData);\r\n\r\n        log.info(\"SVG mapping added\", {\r\n            mapId,\r\n            mappingId: mapping.id,\r\n            operation: \"add_svg_mapping\"\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            data: mapping,\r\n            message: \"SVG mapping added successfully\"\r\n        });\r\n    }\r\n\r\n    async getSvgMappings(req: Request, res: Response): Promise<void> {\r\n        const mapId = validateParams(req.params.id, paramsSchema);\r\n\r\n        const mappings = await this.mapService.getSvgMappings(mapId);\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: mappings,\r\n            message: \"SVG mappings retrieved successfully\"\r\n        });\r\n    }\r\n\r\n    async removeSvgMapping(req: Request, res: Response): Promise<void> {\r\n        // Assuming paramsSchema is the correct validation for a generic ID in the URL params\r\n        const mappingId = validateParams(req.params.mappingId, paramsSchema);\r\n\r\n        const success = await this.mapService.removeSvgMapping(mappingId);\r\n\r\n        log.info(\"SVG mapping removed\", {\r\n            mappingId,\r\n            operation: \"remove_svg_mapping\"\r\n        });\r\n\r\n        res.status(200).json({\r\n            success: true,\r\n            data: success,\r\n            message: \"SVG mapping removed successfully\"\r\n        });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]}]
